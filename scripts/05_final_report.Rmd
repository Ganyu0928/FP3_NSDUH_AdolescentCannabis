---
title: "Perceived Risk and Marijuana Use Among Adolescents (NSDUH 2023)"
student: "Ganyu Liu"
output:
  html_document:
    theme: readable
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE
)

library(tidyverse)
library(car)
library(odds.n.ends)
library(ggplot2)
library(DiagrammeR)
library(DiagrammeRsvg)
library(rsvg)
library(table1)
```
# 1. Background 
Adolescent marijuana use is a persistent public health issue. Although use has remained relatively stable, perceived harm from marijuana continues to decline among youth. Understanding how perceived risk relates to actual use can help inform prevention strategies and targeted public health messaging.

This analysis uses the 2023 National Survey on Drug Use and Health (NSDUH) to examine the relationship between perceived risk of weekly marijuana use and past 30-day marijuana use among adolescents ages 12–17. We also explore whether this relationship differs by sex.

# 2. Methods
## 2.1 Data Source
Data come from the 2023 NSDUH public-use file. All data cleaning, recoding, and analytic preparation were completed systematically using reproducible scripts.
## 2.2 Key Variables
Exposure: Perceived risk of smoking marijuana weekly (RSKMRJWK)
Categories: No risk, Slight risk, Moderate risk, Great risk
Outcome: Past 30-day marijuana use (MJDAY30A)
Categories: No use, Used
Covariate: Sex (IRSEX: Male, Female)
## 2.3 Statistical Analysis
Descriptive statistics summarized the sample and the distribution of exposure, outcome, and covariates. Logistic regression was used to estimate the association between perceived risk and marijuana use. Three models were fit:
Unadjusted model
Adjusted model including sex
Interaction model testing risk × sex
Predicted probabilities and ROC curves were generated to assess model performance.
## 2.4 Study Population
The analytic sample included adolescents ages 12–17 with complete information on perceived risk, past 30-day marijuana use, and sex. Exclusion steps were applied sequentially. A flow diagram (Figure 1) summarizes how the final analytic dataset was created.
# 3. Results
## 3.1 Study Flow and Exclusion Diagram
```{r}
# Load data
load("data_clean/nsduh_2023_clean.Rdata")
start_n <- nrow(data_clean)
# Exclusion 1: missing perceived risk
ex1 <- data_clean %>% drop_na(RSKMRJWK)
n_ex1 <- start_n - nrow(ex1)
# Exclusion 2: missing past 30-day marijuana use
ex2 <- ex1 %>% drop_na(MJDAY30A)
n_ex2 <- nrow(ex1) - nrow(ex2)
# Exclusion 3: missing sex
ex3 <- ex2 %>% drop_na(IRSEX)
n_ex3 <- nrow(ex2) - nrow(ex3)

final_n <- nrow(ex3)
```
Figure 1. Flowchart of exclusions
```{r}
grViz("
digraph flowchart {

node [fontname = Helvetica, shape = rectangle, fontsize = 15]

node1 [label = '@@1']
node2 [label = '@@2']
node3 [label = '@@3']
node4 [label = '@@4']

node1 -> node2 -> node3 -> node4
}

[1]: 'Adolescents ages 12–17 in NSDUH 2023\n n = `r start_n`'
[2]: 'Excluding missing perceived risk (RSKMRJWK)\n n excluded = `r n_ex1`\n n remaining = `r nrow(ex1)`'
[3]: 'Excluding missing past 30-day marijuana use (MJDAY30A)\n n excluded = `r n_ex2`\n n remaining = `r nrow(ex2)`'
[4]: 'Excluding missing sex (IRSEX)\n n excluded = `r n_ex3`\n Final analytic sample = `r final_n`'
")
```
## 3.3 Descriptive Cross-Tabulations
```{r}
table(analytic$RSKMRJWK)
table(analytic$MJDAY30A)
table(analytic$IRSEX)

risk_use <- table(analytic$RSKMRJWK, analytic$MJDAY30A)
risk_use

round(prop.table(risk_use, 1) * 100, 1)
```
## 3.4 Figure 2. Marijuana Use by Perceived Risk
```{r}
ggplot(analytic, aes(x = RSKMRJWK, fill = MJDAY30A)) +
geom_bar(position = "fill") +
labs(
title = "Marijuana Use by Perceived Risk (Adolescents, NSDUH 2023)",
x = "Perceived Risk",
y = "Proportion",
fill = "Past 30-Day Use"
) +
theme_bw()
```
## 3.5 Logistic Regression Models
Model 1: Unadjusted
```{r}
model1 <- glm(MJDAY30A ~ RSKMRJWK,
data = analytic,
family = "binomial")
summary(model1)
odds.n.ends(model1)
```
Model 2: Adjusted for Sex
```{r}
model2 <- glm(MJDAY30A ~ RSKMRJWK + IRSEX,
data = analytic,
family = "binomial")
summary(model2)
odds.n.ends(model2)
```
Likelihood Ratio Test
```{r}
lmtest::lrtest(model1, model2)
```
Model 3: Interaction (RSKMRJWK × Sex)
```{r}
model3_int <- glm(MJDAY30A ~ RSKMRJWK * IRSEX,
data = analytic,
family = "binomial")

summary(model3_int)
odds.n.ends(model3_int)
```
Likelihood Ratio Test (Adjusted vs Interaction)
```{r}
lmtest::lrtest(model2, model3_int)
```
## 3.6 Model Performance
Predicted Probabilities (Adjusted Model)
```{r}
odds.n.ends(model2, predProbPlot = TRUE)
```
ROC Curve (adjusted Model)
```{r}
odds.n.ends(model2, rocPlot = TRUE)
```
Predicted Probabilities (Interaction Model)
```{r}
odds.n.ends(model3_int, predProbPlot = TRUE)
```
ROC Curve (Interaction Model)
```{r}
odds.n.ends(model3_int, rocPlot = TRUE)
```
# 4. Discussion
Perceived risk of weekly marijuana use was strongly associated with past 30-day use among adolescents. Those who viewed marijuana as more risky had substantially lower odds of recent use. These findings remained consistent after adjusting for sex.
The interaction model suggested that perceived risk may operate differently for males and females, with notable differences in the moderate-risk category. While exploratory, this indicates that prevention messaging could benefit from considering gender differences in how adolescents interpret risk.
Overall, these findings highlight the importance of perceived harm in shaping adolescent substance use behaviors and support ongoing public health efforts focused

#5. Reproducibility
All data cleaning, descriptive analysis, and modeling scripts are stored in the project repository:
- 01_data_cleaning.R
- 02_descriptive_analysis.R
- 03_modeling.R
The workflow follows reproducible research practices with transparent version control and structured outputs.